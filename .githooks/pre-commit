#!/usr/bin/env bash

# Git Native Pre-Commit Hook
# Runs terraform validation before user commits

# Reuse the same validation script used by Claude Code
SCRIPT_PATH="$(git rev-parse --show-toplevel)/.claude/scripts/terraform-pre-commit-validation.sh"

if [[ -f "$SCRIPT_PATH" ]]; then
  # Create mock input for the validation script (simulate Claude's tool input)
  MOCK_INPUT='{
    "tool_name": "Bash",
    "tool_input": {
      "command": "git commit",
      "description": "User commit"
    }
  }'

  echo "$MOCK_INPUT" | bash "$SCRIPT_PATH"
else
  echo "Warning: Validation script not found at $SCRIPT_PATH"
  exit 0
fi
