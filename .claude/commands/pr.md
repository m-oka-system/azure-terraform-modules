---
allowed-tools: Bash(gh:*), Bash(git:*)
description: PR の説明を生成し、GitHub にプルリクエストを作成する
---

## コンテキスト

- 現在の git ステータス: !`git status`
- この PR の変更内容: !`git diff main...HEAD`
- この PR のコミット一覧: !`git log --oneline main..HEAD`
- PR テンプレート: @.github/pull_request_template.md

## オプション

| Option | Action                                                                    |
| ------ | ------------------------------------------------------------------------- |
| (なし) | PR を作成する                                                             |
| `-p`   | ブランチを push してから PR を作成する                                    |
| `-u`   | 既存の PR の説明を更新する                                                |
| `-r`   | PR を作成し、自動レビューを実行する（pr-review-toolkit プラグインが必要） |

オプションは組み合わせ可能： `/pr -p -r` で push と PR 作成、自動レビューを実行。

## ワークフロー

### 共通手順（全オプション共通）

1. テンプレートの形式に従って、日本語で PR の説明を生成する
2. 変更内容を視覚化する Mermaid Diagram を含める
3. PR の作成/更新後、ブラウザで PR を開く： `gh pr view --web`

### オプション別の手順

| Option | Command                                                                    |
| ------ | -------------------------------------------------------------------------- |
| (なし) | `gh pr create`                                                             |
| `-p`   | `git push -u origin <branch>` の後に `gh pr create`                        |
| `-u`   | `gh pr edit --body <description>`                                          |
| `-r`   | `gh pr create`（終了コード 0）の後に `/pr-review-toolkit:review-pr` を実行 |

## 要件

### PR の説明

- テンプレートの構成に正確に従う
- すべての内容を日本語で記述する
- 具体的な実装の詳細とテスト手順を含める
- 包括的かつ簡潔に記述する

### Mermaid Diagram

関連する側面を示す図を含める：

- アーキテクチャやデータフローの変更
- コンポーネント間の関係
- 影響を受けるプロセスフロー

ガイドライン：

- 適切な図の種類を使用する（flowchart、sequence、class など）
- 該当する場合は変更前後の状態を示す
- 新規または変更されたコンポーネントを強調する
- **色やスタイリングは使用しない**： `style`、`classDef`、`fill`、`stroke`、色の指定は避ける

## エラーハンドリング

- `gh pr create` が失敗した場合、ワークフローを中断しエラーを報告する
- `-r` オプション：PR の作成は成功したが `/pr-review-toolkit:review-pr` が利用できない場合、ユーザーに警告するが PR の作成は成功とみなす
- `-r` オプション：レビューの実行が失敗した場合、エラーを報告するが作成済みの PR は保持する

**オプションに基づいて PR の説明を生成し、適切なコマンドを実行してください。**
